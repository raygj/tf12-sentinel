#Enforcement mode: hard-mandatory
import "tfplan"

# whitelist of required L4 port list for ingress SG
required_ports = [
  "22",
  "443",

]

main = rule {
  all tfplan.resources.aws_security_group as _, instances {
    all instances as _, sg {
      all required_ports as port {
        any sg.applied.ingress as ingress {
          ingress.from_port <= port and port <= ingress.to_port
        }
      }
    }
  }
}
